// Generated by CIRCT firtool-1.128.0
module LSU(	// src/main/scala/mycpu/core/backend/LSU.scala:9:7
  input         clock,	// src/main/scala/mycpu/core/backend/LSU.scala:9:7
                reset,	// src/main/scala/mycpu/core/backend/LSU.scala:9:7
  output        io_in_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  input         io_in_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  input  [31:0] io_in_bits_pc,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
                io_in_bits_inst,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
                io_in_bits_dnpc,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
                io_in_bits_aluResult,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
                io_in_bits_memWData,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  input  [4:0]  io_in_bits_rdAddr,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  input         io_in_bits_ctrl_regWen,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
                io_in_bits_ctrl_memEn,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
                io_in_bits_ctrl_memWen,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  input  [2:0]  io_in_bits_ctrl_memFunct3,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  input         io_out_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output        io_out_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output [31:0] io_out_bits_pc,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
                io_out_bits_inst,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
                io_out_bits_dnpc,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
                io_out_bits_wbData,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output [4:0]  io_out_bits_rdAddr,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output        io_out_bits_regWen,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  input         io_axi_aw_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output        io_axi_aw_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output [31:0] io_axi_aw_bits_addr,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  input         io_axi_w_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output        io_axi_w_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output [31:0] io_axi_w_bits_data,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output [3:0]  io_axi_w_bits_strb,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output        io_axi_b_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  input         io_axi_b_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
                io_axi_ar_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output        io_axi_ar_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output [31:0] io_axi_ar_bits_addr,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  output        io_axi_r_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  input         io_axi_r_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
  input  [31:0] io_axi_r_bits_data	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
);

  reg  [2:0]       state;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22
  reg  [31:0]      reqReg_pc;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
  reg  [31:0]      reqReg_inst;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
  reg  [31:0]      reqReg_dnpc;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
  reg  [31:0]      reqReg_aluResult;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
  reg  [31:0]      reqReg_memWData;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
  reg  [4:0]       reqReg_rdAddr;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
  reg              reqReg_ctrl_regWen;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
  reg              reqReg_ctrl_memEn;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
  reg              reqReg_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
  reg  [2:0]       reqReg_ctrl_memFunct3;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
  reg  [31:0]      readDataReg;	// src/main/scala/mycpu/core/backend/LSU.scala:21:24
  wire             _GEN = reqReg_ctrl_memFunct3 == 3'h0;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19, :28:92, :36:33
  wire [38:0]      _wdata_T_2 =
    {31'h0, reqReg_memWData[7:0]} << {34'h0, reqReg_aluResult[1:0], 3'h0};	// src/main/scala/mycpu/core/backend/LSU.scala:20:19, :28:92, :33:36, :37:{73,79}
  wire             _GEN_0 = reqReg_ctrl_memFunct3 == 3'h1;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19, :36:33
  wire [4:0]       _wstrb_T_1 = 5'h3 << reqReg_aluResult[1:0];	// src/main/scala/mycpu/core/backend/LSU.scala:20:19, :33:36, :38:34
  wire [46:0]      _wdata_T_5 =
    {31'h0, reqReg_memWData[15:0]} << {42'h0, reqReg_aluResult[1:0], 3'h0};	// src/main/scala/mycpu/core/backend/LSU.scala:20:19, :28:92, :33:36, :37:79, :38:{73,80}
  wire             _GEN_1 = reqReg_ctrl_memFunct3 == 3'h2;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19, :36:33
  wire [31:0]      shiftedData = readDataReg >> {27'h0, reqReg_aluResult[1:0], 3'h0};	// src/main/scala/mycpu/core/backend/LSU.scala:20:19, :21:24, :28:92, :33:36, :44:33
  wire [7:0][31:0] _GEN_2 =
    {{32'h0},
     {32'h0},
     {{16'h0, shiftedData[15:0]}},
     {{24'h0, shiftedData[7:0]}},
     {32'h0},
     {readDataReg},
     {{{16{shiftedData[15]}}, shiftedData[15:0]}},
     {{{24{shiftedData[7]}}, shiftedData[7:0]}}};	// src/main/scala/mycpu/core/backend/LSU.scala:21:24, :36:33, :44:33, :46:17, :47:33, :48:{29,35,40,56,73}, :49:{29,35,40,56,74}, :50:29, :51:{29,43}, :52:{29,43}
  wire             _GEN_3 = state == 3'h1;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :36:33, :55:18
  wire             io_axi_ar_valid_0 = (|state) & _GEN_3;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :23:25, :28:19, :55:18
  wire             _GEN_4 = state == 3'h2;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :36:33, :55:18
  wire             _GEN_5 = ~(|state) | _GEN_3;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :23:25, :31:19, :55:18
  wire             io_axi_r_ready_0 = ~_GEN_5 & _GEN_4;	// src/main/scala/mycpu/core/backend/LSU.scala:31:19, :55:18
  wire             _GEN_6 = state == 3'h3;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :55:18
  wire             io_axi_aw_valid_0 = ~(~(|state) | _GEN_3 | _GEN_4) & _GEN_6;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :23:25, :29:19, :55:18
  wire             _GEN_7 = state == 3'h4;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :55:18
  wire             _GEN_8 = ~(|state) | _GEN_3 | _GEN_4 | _GEN_6;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :23:25, :30:19, :55:18
  wire             io_axi_w_valid_0 = ~_GEN_8 & _GEN_7;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19, :55:18
  wire             _GEN_9 = state == 3'h5;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :55:18
  wire             io_axi_b_ready_0 =
    ~(~(|state) | _GEN_3 | _GEN_4 | _GEN_6 | _GEN_7) & _GEN_9;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :23:25, :31:51, :55:18
  wire             _GEN_10 = state == 3'h6;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :55:18
  always @(posedge clock) begin	// src/main/scala/mycpu/core/backend/LSU.scala:9:7
    automatic logic _GEN_11;	// src/main/scala/chisel3/util/ReadyValidIO.scala:48:35
    _GEN_11 = io_axi_r_ready_0 & io_axi_r_valid;	// src/main/scala/chisel3/util/ReadyValidIO.scala:48:35, src/main/scala/mycpu/core/backend/LSU.scala:31:19, :55:18
    if (reset)	// src/main/scala/mycpu/core/backend/LSU.scala:9:7
      state <= 3'h0;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :28:92
    else if (|state) begin	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :23:25
      automatic logic [2:0]      _GEN_12 = _GEN_10 & io_out_ready ? 3'h0 : state;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :28:92, :55:18, :101:{27,35}
      automatic logic [7:0][2:0] _GEN_13;	// src/main/scala/mycpu/core/backend/LSU.scala:55:18, :67:29, :71:28, :78:29, :84:28, :88:28
      _GEN_13 =
        {{_GEN_12},
         {_GEN_12},
         {io_axi_b_ready_0 & io_axi_b_valid ? 3'h6 : state},
         {io_axi_w_ready & io_axi_w_valid_0 ? 3'h5 : state},
         {io_axi_aw_ready & io_axi_aw_valid_0 ? 3'h4 : state},
         {_GEN_11 ? 3'h6 : state},
         {io_axi_ar_ready & io_axi_ar_valid_0 ? 3'h2 : state},
         {_GEN_12}};	// src/main/scala/chisel3/util/ReadyValidIO.scala:48:35, src/main/scala/mycpu/core/backend/LSU.scala:19:22, :28:19, :29:19, :30:19, :31:51, :36:33, :55:18, :67:{29,37}, :71:28, :73:15, :78:{29,37}, :84:{28,36}, :88:{28,36}, :101:{27,35}
      state <= _GEN_13[state];	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :55:18, :67:29, :71:28, :78:29, :84:28, :88:28
    end
    else if (io_in_valid)	// src/main/scala/mycpu/core/backend/LSU.scala:10:14
      state <= io_in_bits_ctrl_memEn ? {1'h0, io_in_bits_ctrl_memWen, 1'h1} : 3'h6;	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :59:38, :60:{42,50}, :61:31, :62:30
    if (~(|state) & io_in_valid) begin	// src/main/scala/mycpu/core/backend/LSU.scala:19:22, :20:19, :23:25, :55:18, :57:26, :58:16
      reqReg_pc <= io_in_bits_pc;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
      reqReg_inst <= io_in_bits_inst;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
      reqReg_dnpc <= io_in_bits_dnpc;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
      reqReg_aluResult <= io_in_bits_aluResult;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
      reqReg_memWData <= io_in_bits_memWData;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
      reqReg_rdAddr <= io_in_bits_rdAddr;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
      reqReg_ctrl_regWen <= io_in_bits_ctrl_regWen;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
      reqReg_ctrl_memEn <= io_in_bits_ctrl_memEn;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
      reqReg_ctrl_memWen <= io_in_bits_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
      reqReg_ctrl_memFunct3 <= io_in_bits_ctrl_memFunct3;	// src/main/scala/mycpu/core/backend/LSU.scala:20:19
    end
    if (_GEN_5 | ~(_GEN_4 & _GEN_11)) begin	// src/main/scala/chisel3/util/ReadyValidIO.scala:48:35, src/main/scala/mycpu/core/backend/LSU.scala:21:24, :31:19, :55:18, :71:28, :72:21
    end
    else	// src/main/scala/mycpu/core/backend/LSU.scala:21:24, :55:18
      readDataReg <= io_axi_r_bits_data;	// src/main/scala/mycpu/core/backend/LSU.scala:21:24
  end // always @(posedge)
  assign io_in_ready = ~(|state);	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :19:22, :23:25
  assign io_out_valid =
    ~(~(|state) | _GEN_3 | _GEN_4 | _GEN_6 | _GEN_7 | _GEN_9) & _GEN_10;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :19:22, :23:25, :24:16, :55:18
  assign io_out_bits_pc = reqReg_pc;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :20:19
  assign io_out_bits_inst = reqReg_inst;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :20:19
  assign io_out_bits_dnpc = reqReg_dnpc;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :20:19
  assign io_out_bits_wbData =
    reqReg_ctrl_memEn & ~reqReg_ctrl_memWen
      ? _GEN_2[reqReg_ctrl_memFunct3]
      : reqReg_aluResult;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :20:19, :36:33, :46:17, :47:33, :48:29, :49:29, :50:29, :51:29, :52:29, :96:{32,51,54}
  assign io_out_bits_rdAddr = reqReg_rdAddr;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :20:19
  assign io_out_bits_regWen = reqReg_ctrl_regWen;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :20:19
  assign io_axi_aw_valid = io_axi_aw_valid_0;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :29:19, :55:18
  assign io_axi_aw_bits_addr = reqReg_aluResult;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :20:19
  assign io_axi_w_valid = io_axi_w_valid_0;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :30:19, :55:18
  assign io_axi_w_bits_data =
    _GEN
      ? _wdata_T_2[31:0]
      : _GEN_0 ? _wdata_T_5[31:0] : _GEN_1 ? reqReg_memWData : 32'h0;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :20:19, :35:26, :36:33, :37:{55,79}, :38:{55,80}, :39:41
  assign io_axi_w_bits_strb =
    _GEN_8 | ~_GEN_7
      ? 4'h0
      : _GEN ? 4'h1 << reqReg_aluResult[1:0] : _GEN_0 ? _wstrb_T_1[3:0] : {4{_GEN_1}};	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :20:19, :30:{19,91}, :33:36, :34:26, :36:33, :37:{21,34}, :38:{21,34}, :39:21, :55:18
  assign io_axi_b_ready = io_axi_b_ready_0;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :31:51, :55:18
  assign io_axi_ar_valid = io_axi_ar_valid_0;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :28:19, :55:18
  assign io_axi_ar_bits_addr = reqReg_aluResult;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :20:19
  assign io_axi_r_ready = io_axi_r_ready_0;	// src/main/scala/mycpu/core/backend/LSU.scala:9:7, :31:19, :55:18
endmodule

