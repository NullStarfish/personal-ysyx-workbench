// Generated by CIRCT firtool-1.128.0
module LSU(	// src/main/scala/mycpu/core/backend/LSU.scala:10:7
  input         clock,	// src/main/scala/mycpu/core/backend/LSU.scala:10:7
                reset,	// src/main/scala/mycpu/core/backend/LSU.scala:10:7
  output        io_in_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  input         io_in_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  input  [31:0] io_in_bits_pc,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
                io_in_bits_inst,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
                io_in_bits_dnpc,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
                io_in_bits_aluResult,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
                io_in_bits_memWData,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
                io_in_bits_pcTarget,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  input  [4:0]  io_in_bits_rdAddr,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  input         io_in_bits_ctrl_regWen,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
                io_in_bits_ctrl_memEn,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
                io_in_bits_ctrl_memWen,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  input  [2:0]  io_in_bits_ctrl_memFunct3,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  input         io_out_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output        io_out_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output [31:0] io_out_bits_pc,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
                io_out_bits_inst,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
                io_out_bits_dnpc,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
                io_out_bits_wbData,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output [4:0]  io_out_bits_rdAddr,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output        io_out_bits_regWen,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output [31:0] io_out_bits_pcTarget,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  input         io_axi_aw_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output        io_axi_aw_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output [31:0] io_axi_aw_bits_addr,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  input         io_axi_w_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output        io_axi_w_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output [31:0] io_axi_w_bits_data,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output [3:0]  io_axi_w_bits_strb,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output        io_axi_b_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  input         io_axi_b_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
                io_axi_ar_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output        io_axi_ar_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output [31:0] io_axi_ar_bits_addr,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  output        io_axi_r_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  input         io_axi_r_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  input  [31:0] io_axi_r_bits_data,	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
  input  [1:0]  io_axi_r_bits_resp	// src/main/scala/mycpu/core/backend/LSU.scala:11:14
);

  wire             _writeBridge_io_req_ready;	// src/main/scala/mycpu/core/backend/LSU.scala:18:27
  wire             _writeBridge_io_resp_valid;	// src/main/scala/mycpu/core/backend/LSU.scala:18:27
  wire             _readBridge_io_req_ready;	// src/main/scala/mycpu/core/backend/LSU.scala:17:27
  wire             _readBridge_io_resp_valid;	// src/main/scala/mycpu/core/backend/LSU.scala:17:27
  wire [31:0]      _readBridge_io_resp_bits_rdata;	// src/main/scala/mycpu/core/backend/LSU.scala:17:27
  reg              state;	// src/main/scala/mycpu/core/backend/LSU.scala:29:22
  reg  [31:0]      reqReg_pc;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
  reg  [31:0]      reqReg_inst;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
  reg  [31:0]      reqReg_dnpc;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
  reg  [31:0]      reqReg_aluResult;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
  reg  [31:0]      reqReg_pcTarget;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
  reg  [4:0]       reqReg_rdAddr;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
  reg              reqReg_ctrl_regWen;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
  reg              reqReg_ctrl_memEn;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
  reg              reqReg_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
  reg  [2:0]       reqReg_ctrl_memFunct3;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
  wire             _GEN = io_in_bits_ctrl_memFunct3 == 3'h0;	// src/main/scala/mycpu/core/backend/LSU.scala:41:37
  wire [38:0]      _inWdata_T_2 =
    {31'h0, io_in_bits_memWData[7:0]} << {34'h0, io_in_bits_aluResult[1:0], 3'h0};	// src/main/scala/mycpu/core/backend/LSU.scala:36:42, :41:37, :42:{83,89}
  wire             _GEN_0 = io_in_bits_ctrl_memFunct3 == 3'h1;	// src/main/scala/mycpu/core/backend/LSU.scala:41:37
  wire [4:0]       _inWstrb_T_1 = 5'h3 << io_in_bits_aluResult[1:0];	// src/main/scala/mycpu/core/backend/LSU.scala:36:42, :43:36
  wire [46:0]      _inWdata_T_5 =
    {31'h0, io_in_bits_memWData[15:0]} << {42'h0, io_in_bits_aluResult[1:0], 3'h0};	// src/main/scala/mycpu/core/backend/LSU.scala:36:42, :41:37, :42:89, :43:{83,90}
  wire             _GEN_1 = io_in_bits_ctrl_memFunct3 == 3'h2;	// src/main/scala/mycpu/core/backend/LSU.scala:41:37
  wire [3:0]       inWstrb =
    _GEN ? 4'h1 << io_in_bits_aluResult[1:0] : _GEN_0 ? _inWstrb_T_1[3:0] : {4{_GEN_1}};	// src/main/scala/mycpu/core/backend/LSU.scala:36:42, :37:28, :41:37, :42:{23,36}, :43:{23,36}, :44:23
  wire [31:0]      inWdata =
    _GEN
      ? _inWdata_T_2[31:0]
      : _GEN_0 ? _inWdata_T_5[31:0] : _GEN_1 ? io_in_bits_memWData : 32'h0;	// src/main/scala/mycpu/core/backend/LSU.scala:38:28, :41:37, :42:{61,89}, :43:{61,90}, :44:62
  wire             isMemRead = io_in_bits_ctrl_memEn & ~io_in_bits_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:63:{42,45}
  wire             isMemWrite = io_in_bits_ctrl_memEn & io_in_bits_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:64:42
  wire             io_in_ready_0 =
    ~state
    & (~io_in_bits_ctrl_memEn | isMemRead & _readBridge_io_req_ready | isMemWrite
       & _writeBridge_io_req_ready);	// src/main/scala/mycpu/core/backend/LSU.scala:17:27, :18:27, :29:22, :63:42, :64:42, :65:20, :67:{25,42}, :68:16, :69:{16,44}, :70:17
  wire             _GEN_2 = ~state & io_in_valid;	// src/main/scala/mycpu/core/backend/LSU.scala:29:22, :52:33, :73:17, :75:26, :80:26
  wire             writeBridge_io_req_valid = _GEN_2 & ~isMemRead & isMemWrite;	// src/main/scala/mycpu/core/backend/LSU.scala:18:27, :52:33, :56:33, :63:42, :64:42, :73:17, :75:26, :80:26, :81:32
  wire [31:0]      shiftedData =
    _readBridge_io_resp_bits_rdata >> {27'h0, reqReg_aluResult[1:0], 3'h0};	// src/main/scala/mycpu/core/backend/LSU.scala:17:27, :30:19, :41:37, :92:{33,53}
  wire [7:0][31:0] _GEN_3 =
    {{32'h0},
     {32'h0},
     {{16'h0, shiftedData[15:0]}},
     {{24'h0, shiftedData[7:0]}},
     {32'h0},
     {_readBridge_io_resp_bits_rdata},
     {{{16{shiftedData[15]}}, shiftedData[15:0]}},
     {{{24{shiftedData[7]}}, shiftedData[7:0]}}};	// src/main/scala/mycpu/core/backend/LSU.scala:17:27, :92:33, :93:17, :102:33, :103:{29,35,40,56,73}, :104:{29,35,40,56,74}, :105:29, :106:{29,43}, :107:{29,43}
  wire [31:0]      finalLoadData = _GEN_3[reqReg_ctrl_memFunct3];	// src/main/scala/mycpu/core/backend/LSU.scala:30:19, :91:27, :93:17, :102:33, :103:29, :104:29, :105:29, :106:29, :107:29
  wire             _GEN_4 = reqReg_ctrl_memEn & ~reqReg_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19, :118:52, :121:29
  wire             _GEN_5 = reqReg_ctrl_memEn & reqReg_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19, :124:36
  wire             io_out_valid_0 =
    state & (_GEN_4 ? _readBridge_io_resp_valid : ~_GEN_5 | _writeBridge_io_resp_valid);	// src/main/scala/mycpu/core/backend/LSU.scala:17:27, :18:27, :29:22, :113:16, :120:36, :121:{29,53}, :122:20, :124:{36,59}, :125:20, :128:20
  always @(posedge clock) begin	// src/main/scala/mycpu/core/backend/LSU.scala:10:7
    automatic logic _GEN_6;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19, :75:26, :76:27, :77:19
    _GEN_6 = io_in_valid & io_in_ready_0;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19, :67:42, :75:26, :76:27, :77:19
    if (reset)	// src/main/scala/mycpu/core/backend/LSU.scala:10:7
      state <= 1'h0;	// src/main/scala/mycpu/core/backend/LSU.scala:29:22
    else if (state)	// src/main/scala/mycpu/core/backend/LSU.scala:29:22
      state <= ~(state & io_out_ready & io_out_valid_0);	// src/main/scala/chisel3/util/ReadyValidIO.scala:48:35, src/main/scala/mycpu/core/backend/LSU.scala:29:22, :73:17, :85:{26,34}, :113:16, :120:36, :121:53
    else	// src/main/scala/mycpu/core/backend/LSU.scala:29:22
      state <= _GEN_6;	// src/main/scala/mycpu/core/backend/LSU.scala:29:22, :30:19, :75:26, :76:27, :77:19
    if (~state & _GEN_6) begin	// src/main/scala/mycpu/core/backend/LSU.scala:29:22, :30:19, :73:17, :75:26, :76:27, :77:19
      reqReg_pc <= io_in_bits_pc;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
      reqReg_inst <= io_in_bits_inst;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
      reqReg_dnpc <= io_in_bits_dnpc;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
      reqReg_aluResult <= io_in_bits_aluResult;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
      reqReg_pcTarget <= io_in_bits_pcTarget;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
      reqReg_rdAddr <= io_in_bits_rdAddr;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
      reqReg_ctrl_regWen <= io_in_bits_ctrl_regWen;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
      reqReg_ctrl_memEn <= io_in_bits_ctrl_memEn;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
      reqReg_ctrl_memWen <= io_in_bits_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
      reqReg_ctrl_memFunct3 <= io_in_bits_ctrl_memFunct3;	// src/main/scala/mycpu/core/backend/LSU.scala:30:19
    end
  end // always @(posedge)
  AXI4LiteReadBridge readBridge (	// src/main/scala/mycpu/core/backend/LSU.scala:17:27
    .clock                (clock),
    .reset                (reset),
    .io_req_ready         (_readBridge_io_req_ready),
    .io_req_valid         (_GEN_2 & isMemRead),	// src/main/scala/mycpu/core/backend/LSU.scala:52:33, :63:42, :73:17, :75:26, :80:26
    .io_req_bits_addr     (io_in_bits_aluResult),
    .io_resp_ready        (state & _GEN_4 & io_out_ready),	// src/main/scala/mycpu/core/backend/LSU.scala:29:22, :110:29, :120:36, :121:{29,53}, :123:32
    .io_resp_valid        (_readBridge_io_resp_valid),
    .io_resp_bits_rdata   (_readBridge_io_resp_bits_rdata),
    .io_resp_bits_isError (/* unused */),
    .io_axi_ar_ready      (io_axi_ar_ready),
    .io_axi_ar_valid      (io_axi_ar_valid),
    .io_axi_ar_bits_addr  (io_axi_ar_bits_addr),
    .io_axi_r_ready       (io_axi_r_ready),
    .io_axi_r_valid       (io_axi_r_valid),
    .io_axi_r_bits_data   (io_axi_r_bits_data),
    .io_axi_r_bits_resp   (io_axi_r_bits_resp)
  );	// src/main/scala/mycpu/core/backend/LSU.scala:17:27
  wire [31:0]      readBridge_io_resp_bits_rdata;	// src/main/scala/mycpu/core/backend/LSU.scala:17:27
  assign readBridge_io_resp_bits_rdata = _readBridge_io_resp_bits_rdata;	// src/main/scala/mycpu/core/backend/LSU.scala:17:27
  wire             readBridge_io_resp_valid;	// src/main/scala/mycpu/core/backend/LSU.scala:17:27
  assign readBridge_io_resp_valid = _readBridge_io_resp_valid;	// src/main/scala/mycpu/core/backend/LSU.scala:17:27
  AXI4LiteWriteBridge writeBridge (	// src/main/scala/mycpu/core/backend/LSU.scala:18:27
    .clock               (clock),
    .reset               (reset),
    .io_req_ready        (_writeBridge_io_req_ready),
    .io_req_valid        (writeBridge_io_req_valid),	// src/main/scala/mycpu/core/backend/LSU.scala:18:27
    .io_req_bits_addr    (io_in_bits_aluResult),
    .io_req_bits_wdata   (inWdata),	// src/main/scala/mycpu/core/backend/LSU.scala:41:37, :42:61
    .io_req_bits_wstrb   (inWstrb),	// src/main/scala/mycpu/core/backend/LSU.scala:41:37, :42:23
    .io_resp_ready       (state & ~_GEN_4 & _GEN_5 & io_out_ready),	// src/main/scala/mycpu/core/backend/LSU.scala:29:22, :111:29, :120:36, :121:{29,53}, :124:{36,59}, :126:33
    .io_resp_valid       (_writeBridge_io_resp_valid),
    .io_axi_aw_ready     (io_axi_aw_ready),
    .io_axi_aw_valid     (io_axi_aw_valid),
    .io_axi_aw_bits_addr (io_axi_aw_bits_addr),
    .io_axi_w_ready      (io_axi_w_ready),
    .io_axi_w_valid      (io_axi_w_valid),
    .io_axi_w_bits_data  (io_axi_w_bits_data),
    .io_axi_w_bits_strb  (io_axi_w_bits_strb),
    .io_axi_b_ready      (io_axi_b_ready),
    .io_axi_b_valid      (io_axi_b_valid)
  );	// src/main/scala/mycpu/core/backend/LSU.scala:18:27
  assign io_in_ready = io_in_ready_0;	// src/main/scala/mycpu/core/backend/LSU.scala:10:7, :67:42
  assign io_out_valid = io_out_valid_0;	// src/main/scala/mycpu/core/backend/LSU.scala:10:7, :113:16, :120:36, :121:53
  assign io_out_bits_pc = reqReg_pc;	// src/main/scala/mycpu/core/backend/LSU.scala:10:7, :30:19
  assign io_out_bits_inst = reqReg_inst;	// src/main/scala/mycpu/core/backend/LSU.scala:10:7, :30:19
  assign io_out_bits_dnpc = reqReg_dnpc;	// src/main/scala/mycpu/core/backend/LSU.scala:10:7, :30:19
  assign io_out_bits_wbData =
    reqReg_ctrl_memEn & ~reqReg_ctrl_memWen ? finalLoadData : reqReg_aluResult;	// src/main/scala/mycpu/core/backend/LSU.scala:10:7, :30:19, :91:27, :118:{30,49,52}
  assign io_out_bits_rdAddr = reqReg_rdAddr;	// src/main/scala/mycpu/core/backend/LSU.scala:10:7, :30:19
  assign io_out_bits_regWen = reqReg_ctrl_regWen;	// src/main/scala/mycpu/core/backend/LSU.scala:10:7, :30:19
  assign io_out_bits_pcTarget = reqReg_pcTarget;	// src/main/scala/mycpu/core/backend/LSU.scala:10:7, :30:19
endmodule

