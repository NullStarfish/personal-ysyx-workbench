// Generated by CIRCT firtool-1.128.0
module LSU(	// src/main/scala/mycpu/core/backend/LSU.scala:11:7
  input         clock,	// src/main/scala/mycpu/core/backend/LSU.scala:11:7
                reset,	// src/main/scala/mycpu/core/backend/LSU.scala:11:7
  output        io_in_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input         io_in_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input  [31:0] io_in_bits_pc,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_in_bits_inst,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_in_bits_dnpc,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_in_bits_aluResult,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_in_bits_memWData,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_in_bits_pcTarget,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input  [4:0]  io_in_bits_rdAddr,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input         io_in_bits_ctrl_regWen,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_in_bits_ctrl_memEn,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_in_bits_ctrl_memWen,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input  [2:0]  io_in_bits_ctrl_memFunct3,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input         io_out_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output        io_out_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [31:0] io_out_bits_pc,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_out_bits_inst,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_out_bits_dnpc,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_out_bits_wbData,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [4:0]  io_out_bits_rdAddr,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output        io_out_bits_regWen,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [31:0] io_out_bits_pcTarget,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input         io_axi_aw_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output        io_axi_aw_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_axi_aw_bits_id,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [31:0] io_axi_aw_bits_addr,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [7:0]  io_axi_aw_bits_len,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [2:0]  io_axi_aw_bits_size,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [1:0]  io_axi_aw_bits_burst,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input         io_axi_w_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output        io_axi_w_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [31:0] io_axi_w_bits_data,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [3:0]  io_axi_w_bits_strb,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output        io_axi_w_bits_last,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_axi_b_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input         io_axi_b_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_axi_ar_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output        io_axi_ar_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_axi_ar_bits_id,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [31:0] io_axi_ar_bits_addr,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [7:0]  io_axi_ar_bits_len,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [2:0]  io_axi_ar_bits_size,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output [1:0]  io_axi_ar_bits_burst,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  output        io_axi_r_ready,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input         io_axi_r_valid,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
                io_axi_r_bits_id,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input  [31:0] io_axi_r_bits_data,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input  [1:0]  io_axi_r_bits_resp,	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
  input         io_axi_r_bits_last	// src/main/scala/mycpu/core/backend/LSU.scala:12:14
);

  wire             _writeBridge_io_wReq_ready;	// src/main/scala/mycpu/core/backend/LSU.scala:40:27
  wire             _writeBridge_io_bResp_valid;	// src/main/scala/mycpu/core/backend/LSU.scala:40:27
  wire [2:0]       _writeBridge_io_axi_aw_bits_id;	// src/main/scala/mycpu/core/backend/LSU.scala:40:27
  wire             _readBridge_io_rReq_ready;	// src/main/scala/mycpu/core/backend/LSU.scala:39:27
  wire             _readBridge_io_rStream_valid;	// src/main/scala/mycpu/core/backend/LSU.scala:39:27
  wire [31:0]      _readBridge_io_rStream_bits_data;	// src/main/scala/mycpu/core/backend/LSU.scala:39:27
  wire [2:0]       _readBridge_io_axi_ar_bits_id;	// src/main/scala/mycpu/core/backend/LSU.scala:39:27
  reg  [31:0]      reqReg_pc;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
  reg  [31:0]      reqReg_inst;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
  reg  [31:0]      reqReg_dnpc;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
  reg  [31:0]      reqReg_aluResult;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
  reg  [31:0]      reqReg_pcTarget;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
  reg  [4:0]       reqReg_rdAddr;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
  reg              reqReg_ctrl_regWen;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
  reg              reqReg_ctrl_memEn;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
  reg              reqReg_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
  reg  [2:0]       reqReg_ctrl_memFunct3;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
  wire             _GEN = io_in_bits_ctrl_memFunct3 == 3'h0;	// src/main/scala/mycpu/core/backend/LSU.scala:59:37
  wire [38:0]      _inWdata_T_2 =
    {31'h0, io_in_bits_memWData[7:0]} << {34'h0, io_in_bits_aluResult[1:0], 3'h0};	// src/main/scala/mycpu/core/backend/LSU.scala:54:42, :60:{83,89}
  wire             _GEN_0 = io_in_bits_ctrl_memFunct3 == 3'h1;	// src/main/scala/mycpu/core/backend/LSU.scala:59:37
  wire [4:0]       _inWstrb_T_1 = 5'h3 << io_in_bits_aluResult[1:0];	// src/main/scala/mycpu/core/backend/LSU.scala:54:42, :61:36
  wire [46:0]      _inWdata_T_5 =
    {31'h0, io_in_bits_memWData[15:0]} << {42'h0, io_in_bits_aluResult[1:0], 3'h0};	// src/main/scala/mycpu/core/backend/LSU.scala:54:42, :60:89, :61:{83,90}
  wire             _GEN_1 = io_in_bits_ctrl_memFunct3 == 3'h2;	// src/main/scala/mycpu/core/backend/LSU.scala:59:37
  wire [2:0]       size = _GEN ? 3'h0 : _GEN_0 ? 3'h1 : {1'h0, _GEN_1, 1'h0};	// src/main/scala/mycpu/core/backend/LSU.scala:57:28, :59:37, :60:119, :61:119, :62:119
  wire             isMemRead = io_in_bits_ctrl_memEn & ~io_in_bits_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:114:{42,45}
  wire             isMemWrite = io_in_bits_ctrl_memEn & io_in_bits_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:115:42
  wire [31:0]      shiftedData =
    _readBridge_io_rStream_bits_data >> {27'h0, reqReg_aluResult[1:0], 3'h0};	// src/main/scala/mycpu/core/backend/LSU.scala:22:19, :39:27, :121:{33,53}
  wire [7:0][31:0] _GEN_2 =
    {{32'h0},
     {32'h0},
     {{16'h0, shiftedData[15:0]}},
     {{24'h0, shiftedData[7:0]}},
     {32'h0},
     {_readBridge_io_rStream_bits_data},
     {{{16{shiftedData[15]}}, shiftedData[15:0]}},
     {{{24{shiftedData[7]}}, shiftedData[7:0]}}};	// src/main/scala/mycpu/core/backend/LSU.scala:39:27, :121:33, :122:17, :127:33, :128:{29,35,40,56,73}, :129:{29,35,40,56,74}, :130:29, :131:{29,43}, :132:{29,43}
  reg              state;	// src/main/scala/mycpu/core/backend/LSU.scala:159:22
  wire             io_in_ready_0 =
    ~state
    & (~io_in_bits_ctrl_memEn | isMemRead & _readBridge_io_rReq_ready | isMemWrite
       & _writeBridge_io_wReq_ready);	// src/main/scala/mycpu/core/backend/LSU.scala:39:27, :40:27, :114:42, :115:42, :116:20, :159:22, :161:{25,42}, :162:16, :163:{16,45}, :164:17
  wire             _GEN_3 = ~state & io_in_valid;	// src/main/scala/mycpu/core/backend/LSU.scala:152:34, :159:22, :171:17, :173:26, :178:26
  wire             writeBridge_io_wReq_valid = _GEN_3 & ~isMemRead & isMemWrite;	// src/main/scala/mycpu/core/backend/LSU.scala:114:42, :115:42, :152:34, :153:34, :171:17, :173:26, :178:26, :179:32
  wire             _GEN_4 = reqReg_ctrl_memEn & ~reqReg_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19, :141:52, :188:29
  wire             _GEN_5 = reqReg_ctrl_memEn & reqReg_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19, :191:36
  wire             io_out_valid_0 =
    state
    & (_GEN_4 ? _readBridge_io_rStream_valid : ~_GEN_5 | _writeBridge_io_bResp_valid);	// src/main/scala/mycpu/core/backend/LSU.scala:39:27, :40:27, :151:16, :159:22, :187:36, :188:{29,53}, :189:20, :191:{36,59}, :192:20, :195:20
  always @(posedge clock) begin	// src/main/scala/mycpu/core/backend/LSU.scala:11:7
    automatic logic _GEN_6;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19, :173:26, :174:27, :175:19
    _GEN_6 = io_in_valid & io_in_ready_0;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19, :161:42, :173:26, :174:27, :175:19
    if (~state & _GEN_6) begin	// src/main/scala/mycpu/core/backend/LSU.scala:22:19, :159:22, :171:17, :173:26, :174:27, :175:19
      reqReg_pc <= io_in_bits_pc;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
      reqReg_inst <= io_in_bits_inst;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
      reqReg_dnpc <= io_in_bits_dnpc;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
      reqReg_aluResult <= io_in_bits_aluResult;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
      reqReg_pcTarget <= io_in_bits_pcTarget;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
      reqReg_rdAddr <= io_in_bits_rdAddr;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
      reqReg_ctrl_regWen <= io_in_bits_ctrl_regWen;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
      reqReg_ctrl_memEn <= io_in_bits_ctrl_memEn;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
      reqReg_ctrl_memWen <= io_in_bits_ctrl_memWen;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
      reqReg_ctrl_memFunct3 <= io_in_bits_ctrl_memFunct3;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19
    end
    if (reset)	// src/main/scala/mycpu/core/backend/LSU.scala:11:7
      state <= 1'h0;	// src/main/scala/mycpu/core/backend/LSU.scala:159:22
    else if (state)	// src/main/scala/mycpu/core/backend/LSU.scala:159:22
      state <= ~(state & io_out_ready & io_out_valid_0);	// src/main/scala/chisel3/util/ReadyValidIO.scala:48:35, src/main/scala/mycpu/core/backend/LSU.scala:151:16, :159:22, :171:17, :183:{26,34}, :187:36, :188:53
    else	// src/main/scala/mycpu/core/backend/LSU.scala:159:22
      state <= _GEN_6;	// src/main/scala/mycpu/core/backend/LSU.scala:22:19, :159:22, :173:26, :174:27, :175:19
  end // always @(posedge)
  AXI4ReadBridge readBridge (	// src/main/scala/mycpu/core/backend/LSU.scala:39:27
    .clock                (clock),
    .reset                (reset),
    .io_rReq_ready        (_readBridge_io_rReq_ready),
    .io_rReq_valid        (_GEN_3 & isMemRead),	// src/main/scala/mycpu/core/backend/LSU.scala:114:42, :152:34, :171:17, :173:26, :178:26
    .io_rReq_bits_addr    (io_in_bits_aluResult),
    .io_rReq_bits_size    (size),	// src/main/scala/mycpu/core/backend/LSU.scala:59:37, :60:119
    .io_rStream_ready     (state & _GEN_4 & io_out_ready),	// src/main/scala/mycpu/core/backend/LSU.scala:154:34, :159:22, :187:36, :188:{29,53}, :190:35
    .io_rStream_valid     (_readBridge_io_rStream_valid),
    .io_rStream_bits_data (_readBridge_io_rStream_bits_data),
    .io_rStream_bits_resp (/* unused */),
    .io_axi_ar_ready      (io_axi_ar_ready),
    .io_axi_ar_valid      (io_axi_ar_valid),
    .io_axi_ar_bits_id    (_readBridge_io_axi_ar_bits_id),
    .io_axi_ar_bits_addr  (io_axi_ar_bits_addr),
    .io_axi_ar_bits_len   (io_axi_ar_bits_len),
    .io_axi_ar_bits_size  (io_axi_ar_bits_size),
    .io_axi_ar_bits_burst (io_axi_ar_bits_burst),
    .io_axi_r_ready       (io_axi_r_ready),
    .io_axi_r_valid       (io_axi_r_valid),
    .io_axi_r_bits_id     ({2'h0, io_axi_r_bits_id}),	// src/main/scala/mycpu/core/backend/LSU.scala:44:22
    .io_axi_r_bits_data   (io_axi_r_bits_data),
    .io_axi_r_bits_resp   (io_axi_r_bits_resp),
    .io_axi_r_bits_last   (io_axi_r_bits_last)
  );	// src/main/scala/mycpu/core/backend/LSU.scala:39:27
  AXI4WriteBridge writeBridge (	// src/main/scala/mycpu/core/backend/LSU.scala:40:27
    .clock                (clock),
    .reset                (reset),
    .io_wReq_ready        (_writeBridge_io_wReq_ready),
    .io_wReq_valid        (writeBridge_io_wReq_valid),	// src/main/scala/mycpu/core/backend/LSU.scala:153:34, :171:17, :173:26, :178:26, :179:32
    .io_wReq_bits_addr    (io_in_bits_aluResult),
    .io_wReq_bits_size    (size),	// src/main/scala/mycpu/core/backend/LSU.scala:59:37, :60:119
    .io_wStream_valid     (writeBridge_io_wReq_valid),	// src/main/scala/mycpu/core/backend/LSU.scala:153:34, :171:17, :173:26, :178:26, :179:32
    .io_wStream_bits_data
      (_GEN
         ? _inWdata_T_2[31:0]
         : _GEN_0 ? _inWdata_T_5[31:0] : _GEN_1 ? io_in_bits_memWData : 32'h0),	// src/main/scala/mycpu/core/backend/LSU.scala:56:28, :59:37, :60:{61,89}, :61:{61,90}, :62:62
    .io_wStream_bits_strb
      (_GEN
         ? 4'h1 << io_in_bits_aluResult[1:0]
         : _GEN_0 ? _inWstrb_T_1[3:0] : {4{_GEN_1}}),	// src/main/scala/mycpu/core/backend/LSU.scala:54:42, :55:28, :59:37, :60:{23,36}, :61:{23,36}, :62:23
    .io_bResp_ready       (state & ~_GEN_4 & _GEN_5 & io_out_ready),	// src/main/scala/mycpu/core/backend/LSU.scala:156:34, :159:22, :187:36, :188:{29,53}, :191:{36,59}, :193:34
    .io_bResp_valid       (_writeBridge_io_bResp_valid),
    .io_axi_aw_ready      (io_axi_aw_ready),
    .io_axi_aw_valid      (io_axi_aw_valid),
    .io_axi_aw_bits_id    (_writeBridge_io_axi_aw_bits_id),
    .io_axi_aw_bits_addr  (io_axi_aw_bits_addr),
    .io_axi_aw_bits_len   (io_axi_aw_bits_len),
    .io_axi_aw_bits_size  (io_axi_aw_bits_size),
    .io_axi_aw_bits_burst (io_axi_aw_bits_burst),
    .io_axi_w_ready       (io_axi_w_ready),
    .io_axi_w_valid       (io_axi_w_valid),
    .io_axi_w_bits_data   (io_axi_w_bits_data),
    .io_axi_w_bits_strb   (io_axi_w_bits_strb),
    .io_axi_w_bits_last   (io_axi_w_bits_last),
    .io_axi_b_ready       (io_axi_b_ready),
    .io_axi_b_valid       (io_axi_b_valid)
  );	// src/main/scala/mycpu/core/backend/LSU.scala:40:27
  assign io_in_ready = io_in_ready_0;	// src/main/scala/mycpu/core/backend/LSU.scala:11:7, :161:42
  assign io_out_valid = io_out_valid_0;	// src/main/scala/mycpu/core/backend/LSU.scala:11:7, :151:16, :187:36, :188:53
  assign io_out_bits_pc = reqReg_pc;	// src/main/scala/mycpu/core/backend/LSU.scala:11:7, :22:19
  assign io_out_bits_inst = reqReg_inst;	// src/main/scala/mycpu/core/backend/LSU.scala:11:7, :22:19
  assign io_out_bits_dnpc = reqReg_dnpc;	// src/main/scala/mycpu/core/backend/LSU.scala:11:7, :22:19
  assign io_out_bits_wbData =
    reqReg_ctrl_memEn & ~reqReg_ctrl_memWen
      ? _GEN_2[reqReg_ctrl_memFunct3]
      : reqReg_aluResult;	// src/main/scala/mycpu/core/backend/LSU.scala:11:7, :22:19, :122:17, :127:33, :128:29, :129:29, :130:29, :131:29, :132:29, :141:{30,49,52}
  assign io_out_bits_rdAddr = reqReg_rdAddr;	// src/main/scala/mycpu/core/backend/LSU.scala:11:7, :22:19
  assign io_out_bits_regWen = reqReg_ctrl_regWen;	// src/main/scala/mycpu/core/backend/LSU.scala:11:7, :22:19
  assign io_out_bits_pcTarget = reqReg_pcTarget;	// src/main/scala/mycpu/core/backend/LSU.scala:11:7, :22:19
  assign io_axi_aw_bits_id = _writeBridge_io_axi_aw_bits_id[0];	// src/main/scala/mycpu/core/backend/LSU.scala:11:7, :40:27, :45:22
  assign io_axi_ar_bits_id = _readBridge_io_axi_ar_bits_id[0];	// src/main/scala/mycpu/core/backend/LSU.scala:11:7, :39:27, :44:22
endmodule

